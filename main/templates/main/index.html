{% extends "base.html" %}
{% load static %}


{% block content %}

  {% include 'main/includes/header.html' %}
  <!-- Контент страницы (начало) -->
  <main id="mxd-page-content" class="mxd-page-content">


<!-- ===== STYLE: Faqat sidebar uchun yangi stillar ===== -->


<!-- /* style css ushbu ko'rsatilgan fileda brand sidebar ,mobile desktop variant main_sites.css start 21130 */ -->


<div class="mxd-section">
  <div class="mxd-hero-06">
    <div class="mxd-hero-06__wrap loading-wrap">
      <div class="mxd-hero-06__top p-0 m-0">
        <div class="mxd-hero-06__content">

          <!-- Orqa fon (eski) -->
          <div class="mxd-hero-06__video">
            <img src="{% static 'images/autoliga.jpg' %}" alt="" class="mxd-hero-07_image">
            <div class="hero-06-video__cover"></div>
            <div class="hero-06-video__cover"></div>
          </div>

          <!-- Rotating logo + sarlavha (eski, o'zgartirilmagan) -->
          <div class="mxd-hero-06__data">
            <div class="mxd-hero-06__headline">
              <div class="hero-06-headline__descr">
                <div class="hero-06-headline__btn loading__item">
                  <a href="#0" class="btn-rotating btn-rotating-blur-outline ver-04 permanent-desktop">
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                      x="0px" y="0px" viewBox="0 0 160 160" style="enable-background:new 0 0 160 160;"
                      xml:space="preserve" class="btn-rotating__text animate-rotation" data-value="360">
                      <defs>
                        <path id="textPath"
                          d="M149.7,80c0,38.5-31.2,69.7-69.7,69.7S10.3,118.5,10.3,80S41.5,10.3,80,10.3S149.7,41.5,149.7,80z" />
                      </defs>
                      <g>
                        <use xlink:href="#textPath" fill="none"></use>
                        <text>
                          <textPath xlink:href="#textPath">Autoliga — Ishonch✦Barqarorlik ✦Quvvat ✦</textPath>
                        </text>
                      </g>
                    </svg>
                    <img class="btn-rotating__image" src="{% static 'images/logo/autoliga-logo.png' %}"
                      style="filter: brightness(0) invert(1);" alt="Object">
                  </a>
                </div>
              </div>
              <div class="hero-06-headline__content">
                <h1 class="hero-06-headline__title">Autoliga — Ishonch✦Barqarorlik ✦Quvvat ✦</h1>
                <div class="mxd-hero-06__marquee loading__item"></div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Mobil btn (eski, o'zgartirilmagan) -->
      <div class="mxd-hero-06__btn-mobile">
        <a href="#0" class="btn-rotating btn-rotating-blur-outline ver-04 permanent-desktop">
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
            x="0px" y="0px" viewBox="0 0 160 160" style="enable-background:new 0 0 160 160;" xml:space="preserve"
            class="btn-rotating__text animate-rotation" data-value="360">
            <defs>
              <path id="textPathDownloadCV"
                d="M149.7,80c0,38.5-31.2,69.7-69.7,69.7S10.3,118.5,10.3,80S41.5,10.3,80,10.3S149.7,41.5,149.7,80z" />
            </defs>
            <g>
              <use xlink:href="#textPathDownloadCV" fill="none"></use>
              <text>
                <textPath xlink:href="#textPathDownloadCV">FAW — Ishonch✦Barqarorlik✦Quvvat FAWda✦</textPath>
              </text>
            </g>
          </svg>
          <img class="btn-rotating__image" src="{% static 'images/logo/autoliga-logo.png' %}" alt="Object">
        </a>
      </div>

      <!-- ═══════════════════════════════════════════════
           BU YERGA YANGI SIDEBAR QO'SHILDI
           mxd-hero-06__wrap ichida, mxd-hero-06__top tashqarisida
      ════════════════════════════════════════════════ -->

<!-- Scroll tugmalari – faqat desktop uchun (mobil da yashirin) -->
<div class="scroll-controls d-none d-md-flex">
  <button class="scroll-btn" onclick="scrollSidebar('up')">↑</button>
  <button class="scroll-btn" onclick="scrollSidebar('down')">↓</button>
</div>

<!-- Brand sidebar – faqat desktop uchun -->
<div class="brand-sidebar d-none d-md-flex" id="brandSidebar">
  {% for category in productCategory %}
    {% if category.icon %}
      <div class="brand-card"
           data-brand="{{ category.slug }}"
           onclick="openBrand('{{ category.slug }}', this)">
           
        <img src="{{ category.icon.url }}" alt="{{ category.name }}">
      </div>
    {% endif %}
  {% endfor %}
</div>
<!-- for sikl tugadi -->

<!-- MOBIL uchun pastki fixed brendlar -->
<!-- MOBILE BRAND BAR -->
<div class="mobile-brand-bar d-block d-md-none">

  <button class="scroll-arrow left-arrow" id="scrollLeft">←</button>

  <div class="mobile-brand-list" id="mobileBrandList">

    {% for category in productCategory %}
      {% if category.icon %}
        <div class="brand-card"
             data-brand="{{ category.slug }}"
             onclick="openBrand('{{ category.slug }}', this)">
          <img src="{{ category.icon.url }}" alt="{{ category.name }}">
        </div>
      {% endif %}
    {% endfor %}

  </div>

  <button class="scroll-arrow right-arrow" id="scrollRight">→</button>

</div>



<!-- Model panel -->
{% for category in productCategory %}
<div class="model-panel" id="panel-{{ category.slug }}">
    
    <button class="close-btn" onclick="closePanel()">✕</button>

    <div class="model-left">
        <h2>{{ category.name }}</h2>

        <div class="model-list">
            {% for product in category.active_products %}
            <div class="model-item"
                onclick="changeCarImage(
                    '{{ product.main_image.url }}', 
                    '{{ product.slug }}',
                    '{{ category.slug }}')">
                {{ product.title }}
            </div>
            {% endfor %}
        </div>
    </div>

<!-- O'ng taraf -->
<div class="model-right">
    {% if category.active_products %}
        {% with first_product=category.active_products.0 %}
        <img id="carImage-{{ category.slug }}"
             class="car-image"
             src="{{ first_product.main_image.url }}"
             alt="Car">
        <a href="{% url 'product_detail' first_product.slug %}"
           id="detailBtn-{{ category.slug }}"
           class="detail-btn">
            {% if LANGUAGE_CODE == 'uz' %}
                Model to'g'risida batafsil
            {% elif LANGUAGE_CODE == 'ru' %}
                Подробнее o модели
            {% else %}
                Model details
            {% endif %}
        </a>
        {% endwith %}
    {% endif %}
</div>



</div>
{% endfor %}
          <!-- ════════ YANGI QISM TUGADI ════════ -->

    </div>
  </div>
</div>
<!-- Секция героя (конец) -->


<!-- ===== JAVASCRIPT ===== -->





<script>
function changeCarImage(imageUrl, productSlug, categorySlug) {
    const img = document.getElementById('carImage-' + categorySlug);
    if (img) img.src = imageUrl;

    const btn = document.getElementById('detailBtn-' + categorySlug);
    if (btn) btn.href = '/products/' + productSlug + '/';

    //  Active class
    document.querySelectorAll('#panel-' + categorySlug + ' .model-item')
        .forEach(i => i.classList.remove('active'));

    event.currentTarget.classList.add('active');
}

function openBrand(slug, element) {
    const panel = document.getElementById('panel-' + slug);

    if (panel && panel.classList.contains('active')) {
        panel.classList.remove('active');
        element.classList.remove('active');
        return;
    }

    document.querySelectorAll('.model-panel').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.brand-card').forEach(el => el.classList.remove('active'));

    if (panel) panel.classList.add('active');
    element.classList.add('active');
}

function closePanel() {
    document.querySelectorAll('.model-panel').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.brand-card').forEach(el => el.classList.remove('active'));
    document.body.style.overflow = '';
}

function scrollSidebar(direction) {
    const sidebar = document.getElementById('brandSidebar');
    if (!sidebar) return;
    sidebar.scrollTo({
        top: sidebar.scrollTop + (direction === 'up' ? -140 : 140),
        behavior: 'smooth'
    });
}

window.scrollMobileBrands = function(direction) {
    const container = document.getElementById('mobileBrandList');
    if (!container) return;
    container.scrollBy({ left: direction === 'left' ? -200 : 200, behavior: 'smooth' });
};
</script>




<!-- scrool sichqoncha g'ildirakida aylantirsa desktop variantda sidebar uchun -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const sidebar = document.getElementById("brandSidebar");
    if (!sidebar) return;

    sidebar.addEventListener("wheel", function (e) {
        e.stopPropagation();
        sidebar.scrollTop += e.deltaY;
    }, { passive: true });
});
</script>















    <!-- Секция героя (конец) -->

  <!-- Секция — превью блога (начало) -->
    <div class="mxd-section padding-blog">
      <div class="mxd-container grid-container">

        <!-- Блок — заголовок секции (начало) -->
        <div class="mxd-block">
          <div class="mxd-section-title pre-grid">
            <div class="container-fluid p-0">
              <div class="row g-0">
                <div class="col-12 col-xl-12 mxd-grid-item no-margin">
                  <div class="mxd-section-title__hrtitle">
                  <h2 class="reveal-type">
                      {% if request.LANGUAGE_CODE == 'uz' %}
                          Bizning mashinalar
                      {% elif request.LANGUAGE_CODE == 'ru' %}
                          Наши автомобили
                      {% else %}
                          Our Cars
                      {% endif %}
                  </h2>
                  </div>
                </div>
                <div class="col-12 col-xl-8 mxd-grid-item no-margin">
                  <div class="mxd-section-title__hrdescr">
                    <p class="">
                      {% if LANGUAGE_CODE == 'uz' %}Autoliga — bu ishonch, sifat va qulaylik uyg‘unligi. Biz taklif etayotgan avtomobillar zamonaviy texnologiyalar asosida ishlab chiqilgan bo‘lib, kundalik foydalanish va biznes uchun mos yechimlarni taqdim etadi.
                      {% elif LANGUAGE_CODE == 'ru' %}Autoliga — это надежность, качество и удобство. Предлагаемые нами автомобили разработаны на основе современных технологий и обеспечивают функциональность и эффективность для повседневного использования и бизнеса.
                      {% else %}Autoliga — this is reliability, quality and comfort. Our vehicles are developed based on modern technologies and provide functionality and efficiency for daily use and business.
                      {% endif %}
                    </p>
                  </div>
                </div>
                <div class="col-12 col-xl-4 mxd-grid-item no-margin">
                  <div class="mxd-section-title__hrcontrols ">
                    <a class="btn btn-anim btn-default btn-outline slide-right-up" href="#faw-main-contact-form">
                        <span class="btn-caption">
                            {% if request.LANGUAGE_CODE == 'uz' %}
                                Biz bilan bog'laning
                            {% elif request.LANGUAGE_CODE == 'ru' %}
                                Свяжитесь с нами
                            {% else %}
                                Contact Us
                            {% endif %}
                        </span>
                      <i class="ph-bold ph-arrow-up-right"></i>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Блок — заголовок секции (конец) -->

      </div>
    </div>
    <!-- Секция — превью блога (конец) -->

    <!-- Секция — слайдер FAW (начало) -->
    <!-- Скрытый элемент с данными слайдера из Django -->
    <div id="slider-data" style="display: none;">{{ slider_products|safe }}</div>
    <!-- Секция — слайдер FAW (начало) -->
    <div class="mxd-section overflow-hidden" style="margin-top: 6.3rem;">
      <div class="mxd-container">
        <div class="mxd-block">
          <div class="faw-bg">
            <img src="{% static 'images/slider-foto_img/bg-slider.jpg' %}" alt="FAW Slider Background"
              class="faw-bg-image">
          </div>
          <div class="faw-slider-container">
            <div class="faw-slider-main">
              <button class="faw-slider-arrow left-btn" aria-label="back">&#8592;</button>
              <div class="faw-slider-images" id="slider-track">
                <div class="faw-slide left" id="slide-left"></div>
                <div class="faw-slide center" id="slide-center"></div>
                <div class="faw-slide right" id="slide-right"></div>
              </div>
              <button class="faw-slider-arrow right-btn" aria-label="forward">&#8594;</button>
            </div>
            <div class="faw-slider-info" id="slider-info"></div>
          </div>
        </div>
      </div>
    </div>
    <!-- Блок — изображение слайдера (конец) -->
    <!-- Секция — слайдер FAW (конец) -->
    <!-- Секция — контактная форма (начало) -->
    <div class="mxd-section">
      <div class="mxd-container mxd-form-container">

        <!-- НОВАЯ ФОРМА (шаблонный дизайн) -->
        <div class="mxd-block">
          <div class="container-fluid px-0">
            <div class="row gx-0">

              <!-- Left Column - Our Original Contact Info -->
              <div class="col-12 col-md-6 mxd-grid-item mt-0">
                <div class="contact-info">
                  <div class="contact-info__content">
                   <h2 class="contact-info__title">
                      {% if request.LANGUAGE_CODE == 'uz' %}
                          Biz bilan bog'lanish
                      {% elif request.LANGUAGE_CODE == 'ru' %}
                          Связаться с нами
                      {% else %}
                          Contact Us
                      {% endif %}
                  </h2>
                    <p class="contact-info__description ">
                      {% if LANGUAGE_CODE == 'uz' %}
                      Bizning mutaxassislarimiz transportni tanlashda sizga yordam beradi va qiziqtirgan masalalar
                      bo‘yicha maslahat beradi.
                      {% elif LANGUAGE_CODE == 'ru' %}
                      Наш специалисты помогут вам выбрать транспорт и дадут советы по интересующим вас вопросам.
                      {% else %}
                      Our specialists will help you choose the transport and provide advice on issues that interest you.
                      {% endif %}
                    </p>

                    <div class="contact-info__details">
                      <div class="contact-detail ">
                        <div class="contact-detail__icon">
                          <i class="ph-fill ph-phone"></i>
                        </div>
                        <div class="contact-detail__content">
                          <h4 class="contact-detail__title">Telefon</h4>
                          <a href="tel:+998712345678" class="contact-detail__value">+998 00 000 00 00</a>
                        </div>
                      </div>

                      <div class="contact-detail ">
                        <div class="contact-detail__icon">
                          <i class="ph-fill ph-envelope"></i>
                        </div>
                        <div class="contact-detail__content">
                          <h4 class="contact-detail__title">Email</h4>
                          <a href="mailto:info@fawtrucks.uz" class="contact-detail__value">example@autoliga.uz</a>
                        </div>
                      </div>

                      <div class="contact-detail ">
                        <div class="contact-detail__icon">
                          <i class="ph-fill ph-map-pin"></i>
                        </div>
                        <div class="contact-detail__content">
                          <h4 class="contact-detail__title">Manzil</h4>
                          <p class="contact-detail__value">Lorem ipsum dolor sit amet consectetur adipisicing.
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Right Column - Form with Template Design -->
              <div class="col-12 col-md-6 mxd-grid-item" id="faw-main-contact-form">
                <div class="mxd-block__content contact">
                  <div class="mxd-block__inner-form loading__fade">
                    <div class="form-container">

                      <!-- Сообщение о статусе (встроенное уведомление) -->
                      <div class="form-status hidden">
                        <p class="form-status__text"></p>
                      </div>

                      <!-- Форма контакта (начало) -->
                      <form class="form contact-form" id="contactForm">
                        {% csrf_token %}

                        <div class="container-fluid p-0">
                          <div class="row gx-0">
                            <div class="col-12 mxd-grid-item ">
                                <input type="text" name="name" placeholder="{% if request.LANGUAGE_CODE == 'uz' %}Ismingiz*{% elif request.LANGUAGE_CODE == 'ru' %}Ваше имя*{% else %}Your Name*{% endif %}" required>
                            </div>
                            <div class="col-12 mxd-grid-item ">
                              <select name="region" required>
                                <option value="" disabled selected>
                                  {% if LANGUAGE_CODE == 'uz' %}
                                  Viloyatni tanlang*
                                  {% elif LANGUAGE_CODE == 'ru' %}
                                  Выберите область*
                                  {% else %}
                                  Select Region*
                                  {% endif %}
                                </option>
                                <option value="Toshkent shahri">
                                  {% if LANGUAGE_CODE == 'uz' %}Toshkent shahri{% elif LANGUAGE_CODE == 'ru' %}Город Ташкент{% else %}Tashkent City{% endif %}
                                </option>
                                <option value="Andijon viloyati">
                                  {% if LANGUAGE_CODE == 'uz' %}Andijon viloyati{% elif LANGUAGE_CODE == 'ru' %}Андижанская область{% else %}Andijan Region{% endif %}
                                </option>
                                <option value="Buxoro viloyati">
                                  {% if LANGUAGE_CODE == 'uz' %}Buxoro viloyati{% elif LANGUAGE_CODE == 'ru' %}Бухарская область{% else %}Bukhara Region{% endif %}
                                </option>
                                <option value="Fargʻona viloyati">
                                  {% if LANGUAGE_CODE == 'uz' %}Fargʻona viloyati{% elif LANGUAGE_CODE == 'ru' %}Ферганская область{% else %}Fergana Region{% endif %}
                                </option>
                                <option value="Jizzax viloyati">
                                  {% if LANGUAGE_CODE == 'uz' %}Jizzax viloyati{% elif LANGUAGE_CODE == 'ru' %}Джизакская область{% else %}Jizzakh Region{% endif %}
                                </option>
                                <option value="Xorazm viloyati">
                                  {% if LANGUAGE_CODE == 'uz' %}Xorazm viloyati{% elif LANGUAGE_CODE == 'ru' %}Хорезмская область{% else %}Khorezm Region{% endif %}
                                </option>
                                <option value="Namangan viloyati">
                                  {% if LANGUAGE_CODE == 'uz' %}Namangan viloyati{% elif LANGUAGE_CODE == 'ru' %}Наманганская область{% else %}Namangan Region{% endif %}
                                </option>
                                <option value="Navoiy viloyati">
                                  {% if LANGUAGE_CODE == 'uz' %}Navoiy viloyati{% elif LANGUAGE_CODE == 'ru' %}Навоийская область{% else %}Navoi Region{% endif %}
                                </option>
                                <option value="Qashqadaryo viloyati">
                                  {% if LANGUAGE_CODE == 'uz' %}Qashqadaryo viloyati{% elif LANGUAGE_CODE == 'ru' %}Кашкадарьинская область{% else %}Kashkadarya Region{% endif %}
                                </option>
                                <option value="Samarqand viloyati">
                                  {% if LANGUAGE_CODE == 'uz' %}Samarqand viloyati{% elif LANGUAGE_CODE == 'ru' %}Самаркандская область{% else %}Samarkand Region{% endif %}
                                </option>
                                <option value="Sirdaryo viloyati">
                                  {% if LANGUAGE_CODE == 'uz' %}Sirdaryo viloyati{% elif LANGUAGE_CODE == 'ru' %}Сырдарьинская область{% else %}Syrdarya Region{% endif %}
                                </option>
                                <option value="Surxondaryo viloyati">
                                  {% if LANGUAGE_CODE == 'uz' %}Surxondaryo viloyati{% elif LANGUAGE_CODE == 'ru' %}Сурхандарьинская область{% else %}Surkhandarya Region{% endif %}
                                </option>
                                <option value="Toshkent viloyati">
                                  {% if LANGUAGE_CODE == 'uz' %}Toshkent viloyati{% elif LANGUAGE_CODE == 'ru' %}Ташкентская область{% else %}Tashkent Region{% endif %}
                                </option>
                                <option value="Qoraqalpogʻiston Respublikasi">
                                  {% if LANGUAGE_CODE == 'uz' %}Qoraqalpogʻiston Respublikasi{% elif LANGUAGE_CODE == 'ru' %}Республика Каракалпакстан{% else %}Republic of Karakalpak{% endif %}
                                </option>
                              </select>
                            </div>
                            <div class="col-12 mxd-grid-item ">
                              <input type="tel" name="phone" placeholder="+998 (__) ___-__-__" id="phoneInput"
                                pattern="[+]*[0-9\s\-\(\)]*" data-default="+998" required>
                            </div>
                            <div class="col-12 mxd-grid-item ">
                              <textarea name="message" placeholder="{% if LANGUAGE_CODE == 'uz' %}Qanday mashinasiga qiziqasiz? Qoʻshimcha savollar*{% elif LANGUAGE_CODE == 'ru' %}Какая машина вас интересует? Дополнительные вопросы*{% else %}What Car are you interested in? Additional questions*{% endif %}"></textarea>
                            </div>
                            <div class="col-12 mxd-grid-item ">
                              <button class="btn btn-anim btn-default btn-large btn-opposite slide-right-up shimmer-btn"
                                type="submit">
                                <span class="btn-caption">
                                  {% if LANGUAGE_CODE == 'uz' %}
                                  Qongʻiroq kutaman
                                  {% elif LANGUAGE_CODE == 'ru' %}
                                  Жду звонка
                                  {% else %}
                                  Awaiting a call
                                  {% endif %}
                                </span>
                                <span class="shimmer"></span>
                                <i class="ph-bold ph-arrow-up-right"></i>
                              </button>
                            </div>
                          </div>
                        </div>
                      </form>
                      <!-- Форма контакта (конец) -->

                    </div>
                  </div>
                </div>
              </div>
              <!-- Right Column - Form with Template Design end-->
            </div>
          </div>
        </div>
        <!-- Блок — контактная форма (конец) -->

      </div>
    </div>
    <!-- Секция — контактная форма (конец) -->

    <!-- Section - Inner Pages Slider Start -->
    <div class="mxd-section padding-pre-grid">
      <div class="mxd-container grid-container">

        <!-- Block - Inner Pages Slider Start -->
        <div class="mxd-block">
          <!-- Заголовок с переводами -->
          {% if LANGUAGE_CODE == 'uz' %}
          <h2 class="reveal-type " style="text-align: center;">Yangiliklar</h2>
          {% elif LANGUAGE_CODE == 'ru' %}
          <h2 class="reveal-type " style="text-align: center;">Новости</h2>
          {% else %}
          <h2 class="reveal-type " style="text-align: center;">News</h2>
          {% endif %}

          <!-- Slider main container -->
          <div class="mxd-demo-swiper mxd-grid-item ">
            <!-- Additional required wrapper -->
            <div class="swiper-wrapper">

              {% for news in news_list %}
              <!-- single slide -->
              <div class="swiper-slide mxd-demo-swiper__slide">
                <a href="{% url 'news_detail' news.slug %}" class="slide-content"
                  style="text-decoration: none; color: inherit;">
                  <!-- Аватарка и заголовок в одной строке -->
                  <div class="slide-header-row">
                    <div class="slide-header">
                      <h3 class="slide-header__title">{{ news.title }}</h3>
                    </div>
                  </div>

                  <!-- Полный текст БЕЗ ДАТЫ -->
                  <div class="slide-text">
                    <p class="slide-text__content">{{ news.desc }}</p>
                  </div>

                  <!-- Картинка -->
                  <div class="slide-image">
                    {% if news.preview_image %}
                    <img src="{{ news.preview_image.url }}" alt="{{ news.title }}">
                    {% else %}
                    <img src="{% static 'images/news/placeholder.jpg' %}" alt="{{ news.title }}">
                    {% endif %}
                  </div>
                </a>
              </div>
              {% empty %}
              <!-- Пустая заглушка -->
              <div class="swiper-slide mxd-demo-swiper__slide">
                <div class="slide-content" style="text-align: center; padding: 60px 20px;">
                  <p style="font-size: 18px; color: #888;">
                    {% if LANGUAGE_CODE == 'uz' %}
                    Hozircha yangiliklar yo'q
                    {% elif LANGUAGE_CODE == 'ru' %}
                    Пока нет новостей
                    {% else %}
                    No news yet
                    {% endif %}
                  </p>
                </div>
              </div>
              {% endfor %}

            </div>
            <!-- navigation buttons -->
            <div class="swiper-button-prev mxd-slider-btn mxd-slider-btn-round-prev v2">
              <a class="btn btn-round btn-round-small btn-outline slide-left anim-no-delay" href="#0">
                <i class="ph ph-arrow-left"></i>
              </a>
            </div>
            <div class="swiper-button-next mxd-slider-btn mxd-slider-btn-round-next v2">
              <a class="btn btn-round btn-round-small btn-outline slide-right anim-no-delay" href="#0">
                <i class="ph ph-arrow-right"></i>
              </a>
            </div>
          </div>
        </div>
        <!-- Block - Inner Pages Slider End -->

      </div>
    </div>
    <!-- Section - Inner Pages Slider End -->
  </main>
  <!-- Контент страницы (конец) -->
  {% include 'main/includes/footer.html' %}
  <!-- Кнопка «вверх» (начало) -->
  <a href="#0" id="to-top" class="btn btn-to-top slide-up anim-no-delay">
    <i class="ph ph-arrow-up"></i>
  </a>
  <!-- Кнопка «вверх» (конец) -->

  <!-- Подключение скриптов (начало) -->
  <script src="{% static 'js/libs.min.js' %}"></script>
  <script src="{% static 'js/app.js' %}"></script>
  <script src="{% static 'js/error-logger.js' %}"></script>
  <script src="{% static 'js/main-setting.js' %}"></script>

  <!-- Мобильный фикс: надёжно отключаем инлайн-стили параллакса для маленьких экранов -->
  <script>
    (function () {
      var observer = null;

      function cleanNode(el) {
        try {
          el.style.transform = 'none';
          el.style.webkitTransform = 'none';
          el.style.inset = '';
          el.style.top = '';
          el.style.left = '';
          el.style.right = '';
          el.style.bottom = '';
          el.style.position = 'static';
        } catch (e) {/* игнорируем ошибки */ }
      }

      function disableParallaxInline() {
        if (window.innerWidth > 550) return;
        var containers = document.querySelectorAll('.mxd-blog-preview__image');
        containers.forEach(function (container) {
          cleanNode(container);
          container.querySelectorAll('*').forEach(function (child) { cleanNode(child); });

          var img = container.querySelector('img');
          if (img) {
            img.style.transform = 'none';
            img.style.webkitTransform = 'none';
            img.style.inset = '';
            img.style.top = '';
            img.style.left = '';
            img.style.right = '';
            img.style.bottom = '';
            img.style.position = 'static';
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.objectFit = 'cover';
            img.style.objectPosition = 'center center';
            img.style.margin = '0';
            img.style.display = 'block';
          }
        });
      }

      function startObserver() {
        if (window.innerWidth > 550) {
          if (observer) {
            observer.disconnect();
            observer = null;
          }
          return;
        }
        if (observer) return;

        var config = { attributes: true, attributeFilter: ['style'], subtree: true, childList: true };
        observer = new MutationObserver(function (mutations) {
          var shouldRun = false;
          for (var i = 0; i < mutations.length; i++) {
            var m = mutations[i];
            if (m.type === 'attributes' || m.type === 'childList') {
              if (m.target && m.target.closest && m.target.closest('.mxd-blog-preview__image')) {
                shouldRun = true;
                break;
              }
              if (m.addedNodes && m.addedNodes.length) {
                for (var j = 0; j < m.addedNodes.length; j++) {
                  if (m.addedNodes[j].closest && m.addedNodes[j].closest('.mxd-blog-preview__image')) {
                    shouldRun = true;
                    break;
                  }
                }
              }
            }
          }
          if (shouldRun) disableParallaxInline();
        });

        document.querySelectorAll('.mxd-blog-preview__image').forEach(function (node) {
          observer.observe(node, config);
        });
      }

      function init() {
        disableParallaxInline();
        startObserver();
      }

      window.addEventListener('DOMContentLoaded', init);
      window.addEventListener('load', init);

      var resizeTimer;
      window.addEventListener('resize', function () {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function () {
          disableParallaxInline();
          startObserver();
        }, 200);
      });

      var runs = 0;
      var interval = setInterval(function () {
        disableParallaxInline();
        startObserver();
        runs++;
        if (runs > 12) {
          clearInterval(interval);
        }
      }, 500);
    })();

    // ============ ОБРАБОТКА ФОРМЫ (ПОСЛЕ ФУНКЦИЙ!) ============
    let isSubmitting = false;

    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("contactForm");
      const phoneInput = document.getElementById("phoneInput");
      const statusBlock = document.querySelector(".form-status");
      const statusText = statusBlock.querySelector(".form-status__text");

      // Маска телефона
      phoneInput.addEventListener("input", (e) => {
        let value = e.target.value.replace(/\D/g, "");
        if (!value.startsWith("998")) value = "998" + value;
        if (value.length > 12) value = value.slice(0, 12);

        let formatted = "+998 ";
        if (value.length > 3) formatted += "(" + value.slice(3, 5);
        if (value.length >= 5) formatted += ") " + value.slice(5, 8);
        if (value.length >= 8) formatted += "-" + value.slice(8, 10);
        if (value.length >= 10) formatted += "-" + value.slice(10, 12);

        e.target.value = formatted;
      });

      // Отправка формы
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        if (isSubmitting) return;
        isSubmitting = true;

        const phone = phoneInput.value.replace(/\D/g, "");
        if (phone.length !== 12) {
          showStatus("❌ Iltimos, telefon raqamingizni to'liq kiriting.", "error");
          isSubmitting = false;
          return;
        }

        const utmData = window.getUTMData();

        const formData = {
          name: form.name.value,
          region: form.region.value,
          phone: phoneInput.value,
          message: form.message.value || '',
          referer: document.referrer || window.location.href,
          utm_data: utmData,
          visitor_uid: sessionStorage.getItem('amo_visitor_uid') || null
        };

        try {
          const response = await fetch("/api/uz/contact/", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "X-CSRFToken": form.querySelector("[name=csrfmiddlewaretoken]").value,
            },
            body: JSON.stringify(formData),
          });

          const data = await response.json();

          if (response.ok) {
            (window.dataLayer = window.dataLayer || []).push({
              event: "lead_form_submitted"
            });

            showStatus("✅ Xabar yuborildi! Tez orada siz bilan bog'lanamiz.", "success");
            form.reset();
          } else {
            throw new Error(data.message || "Xatolik yuz berdi.");
          }
        } catch (error) {
          console.error("Form error:", error);
          showStatus("❌ Xatolik yuz berdi. Qayta urinib ko'ring.", "error");
        } finally {
          isSubmitting = false;
        }
      });

      // Показ статуса
      function showStatus(message, type = "success") {
        statusText.textContent = message;
        statusBlock.className = `form-status ${type} show`;
        statusBlock.classList.remove("hidden");

        setTimeout(() => {
          statusBlock.classList.remove("show");
          setTimeout(() => statusBlock.classList.add("hidden"), 400);
        }, 4000);
      }
    });

    document.addEventListener('DOMContentLoaded', () => {
    const images = document.querySelectorAll('img[data-src]');
    const imageObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                img.src = img.dataset.src;
                imageObserver.unobserve(img);
            }
        });
    });
    images.forEach(img => imageObserver.observe(img));
});
  </script>




{% endblock content %}